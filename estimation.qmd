---
title: "Estimation"
execute: 
  echo: false
html:
    code-fold: true
    code-summary: "Show the code"
---

Using bat call data provided by the state of Montana, we fit a set of multistate multiscale occupancy models to assess the effects of environmental covariates on the probability of bat occupancy. These models are multistate because they consider different levels of bat activity (no bats, few bats, many bats), and multi-scale since each sampled grid cell had multiple sites sampled over a varying number of nights. 

# Model descriptions 

## Null multi-state multi-scale model 

A grid cell $i$ is in one of the three states described (1 = no bats, 2 = few bats, 3 = many bats) given:

$$
z_i \sim \text{Categorical}(\Omega)
$$
where the vector of probabilities for each state follows: 

$$
\Omega = [1-\psi \quad \psi(1-r) \quad \psi r]
$$

where $\psi$ is the probability that a grid cell is occupied by bats, and if occupied, $r$ is the probability that it will be occupied by many bats. In this null model we assume that these probabilities are the same across all grid cells, with no influence of covariates.  

We incorporate the multi-scale component into this model by considering local availability as follows:

$$
a_{i,j} \sim \text{Categorical}[\Theta]
$$
The matrix $\Theta$ gives the probabilities of bats being locally available in each site given their occupancy at the grid cell level. The matrix of probabilities is described as follows: 

$$
\Theta = \begin{bmatrix}
         1 & 0 & 0 \\
         1-\theta_2 & \theta_2 & 0 \\
         \theta_{31} & \theta_{32} & \theta_{33}
         \end{bmatrix}
$$
And the detection model follows for each one of the $k$ surveys on each site $j$ within a grid cell $i$: 

$$
y_{i,j,k} \sim \text{Categorical}(detP)
$$

Where $detP$ is given by: 


$$
detP = \begin{bmatrix}
         1 & 0 & 0 \\
         1-p_2 & p_2 & 0 \\
         p_{31} & p_{32} & p_{33}
         \end{bmatrix}
$$

